(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7],{63:(e,t,r)=>{"use strict";var i=r(7260);r.o(i,"useParams")&&r.d(t,{useParams:function(){return i.useParams}}),r.o(i,"useRouter")&&r.d(t,{useRouter:function(){return i.useRouter}})},2906:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>u});var i=r(5155),s=r(2115),a=r(63),l=r(4585),n=r(9708),c=r(598),o=r(2943);function u(){let e=(0,a.useParams)(),t=(0,a.useRouter)(),[r,u]=(0,s.useState)({title:"",visibility:"private"}),[d,m]=(0,s.useState)(!0),[b,x]=(0,s.useState)(!1),[h,p]=(0,s.useState)(null),[f,v]=(0,s.useState)([]),[y,g]=(0,s.useState)(""),[N,j]=(0,s.useState)(null);async function w(i){i.preventDefault(),p(null),x(!0);try{let i=(0,l.Cy)(),s=null==i?void 0:i.currentUser;if(!s)return void p("Please sign in");let a=o.ES.parse(r),c=(0,o.BO)(a),u=(0,l.Lf)();if(!u)throw Error("No DB");await (0,n.BN)((0,n.H9)(u,"collections",e.id),{...c,ownerId:s.uid,updatedAt:(0,n.O5)()},{merge:!0}),t.push("/collections")}catch(e){if(e instanceof c.GaX){var s;p((null==(s=e.issues[0])?void 0:s.message)||"Validation error")}else e instanceof Error?p(e.message):p("Unknown error")}finally{x(!1)}}return((0,s.useEffect)(()=>{!async function(){try{let t=(0,l.Lf)();if(!t)return;let r=await (0,n.x7)((0,n.H9)(t,"collections",e.id));if(r.exists()){let e=r.data();u({title:e.title||"",visibility:e.visibility||"private"})}let i=await (0,n.GG)((0,n.rJ)(t,"collections",e.id,"items"));v(i.docs.map(e=>({id:e.id,...e.data()})))}catch(e){p(e instanceof Error?e.message:"Failed to load")}finally{m(!1)}}()},[e.id]),d)?(0,i.jsx)("div",{className:"mx-auto max-w-[720px] py-8",children:"Loading…"}):(0,i.jsxs)("div",{className:"mx-auto max-w-[720px] py-8",children:[(0,i.jsx)("h1",{className:"font-display text-2xl mb-4",children:"Edit Collection"}),(0,i.jsxs)("form",{onSubmit:w,className:"space-y-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm mb-1",children:"Title"}),(0,i.jsx)("input",{className:"w-full rounded-[12px] bg-[var(--gh-surface)] border border-[var(--gh-border)] px-3 py-2 text-sm",value:r.title,onChange:e=>u({...r,title:e.target.value})})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"block text-sm mb-1",children:"Visibility"}),(0,i.jsxs)("select",{className:"w-full rounded-[12px] bg-[var(--gh-surface)] border border-[var(--gh-border)] px-3 py-2 text-sm",value:r.visibility,onChange:e=>u({...r,visibility:e.target.value}),children:[(0,i.jsx)("option",{value:"private",children:"Private"}),(0,i.jsx)("option",{value:"public",children:"Public"})]})]}),h&&(0,i.jsx)("p",{className:"text-sm text-red-400",children:h}),(0,i.jsx)("button",{type:"submit",disabled:b,className:"rounded-[12px] px-4 py-2 text-sm bg-[var(--gh-cyan)] text-black",children:b?"Saving…":"Save"})]}),(0,i.jsxs)("div",{className:"mt-8",children:[(0,i.jsx)("h2",{className:"font-display text-lg mb-2",children:"Collaborators"}),(0,i.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,i.jsx)("input",{placeholder:"user email (viewer/editor)",value:y,onChange:e=>g(e.target.value),className:"rounded-[12px] bg-[var(--gh-surface)] border border-[var(--gh-border)] px-3 py-2 text-sm flex-1"}),(0,i.jsx)("button",{className:"text-sm text-[var(--gh-cyan)]",onClick:async()=>{j(null);try{let t=(0,l.Lf)();if(!t)throw Error("No DB");let r=(0,n.H9)(t,"collections",e.id);await (0,n.BN)(r,{collaborators:{[y.toLowerCase()]:"viewer"}},{merge:!0})}catch(e){j(e instanceof Error?e.message:"Failed")}},children:"Add viewer"}),(0,i.jsx)("button",{className:"text-sm text-[var(--gh-cyan)]",onClick:async()=>{j(null);try{let t=(0,l.Lf)();if(!t)throw Error("No DB");let r=(0,n.H9)(t,"collections",e.id);await (0,n.BN)(r,{collaborators:{[y.toLowerCase()]:"editor"}},{merge:!0})}catch(e){j(e instanceof Error?e.message:"Failed")}},children:"Add editor"})]}),N&&(0,i.jsx)("div",{className:"text-sm text-red-400 mt-2",children:N})]}),(0,i.jsxs)("div",{className:"mt-8",children:[(0,i.jsx)("h2",{className:"font-display text-lg mb-2",children:"Items"}),(0,i.jsxs)("div",{className:"space-y-2",children:[f.map(t=>(0,i.jsxs)("div",{className:"flex items-center justify-between rounded-[12px] border border-[var(--gh-border)] bg-[var(--gh-surface)] p-3 text-sm",children:[(0,i.jsx)("span",{children:t.promptId}),(0,i.jsx)("button",{className:"text-[var(--gh-cyan)]",onClick:async()=>{try{let r=(0,l.Lf)();if(!r)throw Error("No DB");await (0,n.kd)((0,n.H9)(r,"collections",e.id,"items",t.id)),v(e=>e.filter(e=>e.id!==t.id))}catch(e){}},children:"Remove"})]},t.id)),0===f.length&&(0,i.jsx)("div",{className:"text-sm text-[var(--gh-text-muted)]",children:"No items yet."})]})]})]})}},2943:(e,t,r)=>{"use strict";r.d(t,{BO:()=>n,ES:()=>l,Tk:()=>a,Uz:()=>s});var i=r(598);let s=i.Ikc({title:i.YjP().min(1,"Title is required").max(200),body:i.YjP().min(1,"Body is required").max(5e3),tags:i.YOg(i.YjP()).default([]),sourceUrl:i.YjP().url().nullable().optional().default(null),visibility:i.k5n(["public","unlisted","private"]).default("public")});function a(e){let t=e.title.trim(),r=e.body.replace(/\r\n/g,"\n").trim(),i=Array.from(new Set((e.tags||[]).map(e=>e.trim().toLowerCase()))).sort();return{title:t,body:r,tags:i,sourceUrl:e.sourceUrl||null,visibility:e.visibility||"public"}}let l=i.Ikc({title:i.YjP().min(1,"Title is required").max(120),visibility:i.k5n(["public","private"]).default("private")});function n(e){return{title:e.title.trim(),visibility:e.visibility||"private"}}},4585:(e,t,r)=>{"use strict";r.d(t,{Cy:()=>m,Lf:()=>b});var i=r(2078),s=r(2553),a=r(9708);r(9996);let l=null,n=null,c=!1,o={NEXT_PUBLIC_FIREBASE_API_KEY:"AIzaSyBVxbbtB8yqSycBKbVs4HpORCc69nexI8c",NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN:"glyph-hub-5000.firebaseapp.com",NEXT_PUBLIC_FIREBASE_PROJECT_ID:"glyph-hub-5000",NEXT_PUBLIC_FIREBASE_APP_ID:"1:58219751174:web:18337f5441f6cf1f06a087"};function u(){return Object.entries(o).filter(e=>{let[,t]=e;return!t}).map(e=>{let[t]=e;return t})}function d(){return l||(0!==u().length?(c||(c=!0,console.warn("[firebase] Missing Firebase env vars. Add web/.env.local with NEXT_PUBLIC_ keys. Missing:",u())),null):l=(0,i.Dk)().length?(0,i.Sx)():(0,i.Wp)({apiKey:"AIzaSyBVxbbtB8yqSycBKbVs4HpORCc69nexI8c",authDomain:"glyph-hub-5000.firebaseapp.com",projectId:"glyph-hub-5000",storageBucket:"glyph-hub-5000.firebasestorage.app",messagingSenderId:"58219751174",appId:"1:58219751174:web:18337f5441f6cf1f06a087",measurementId:"G-N4T4Z5ZTL6"}))}function m(){let e=d();if(!e)return null;if(n)return n;try{n=(0,s.xI)(e)}catch(t){n=(0,s.Nu)(e,{persistence:[s.Gt,s.F0,s.iM]})}return n}function b(){let e=d();if(!e)return null;try{return(0,a._A)(e,{localCache:(0,a.vK)({tabManager:(0,a.K7)()})})}catch(t){return(0,a.aU)(e)}}},4791:(e,t,r)=>{Promise.resolve().then(r.bind(r,2906))}},e=>{e.O(0,[135,965,31,598,441,255,358],()=>e(e.s=4791)),_N_E=e.O()}]);